# SQL/ActiveRecord

---

# Warmup

Assume a Rails app that has owners and horses.

How would you find the following in ActiveRecord? SQL?

* Average age of all horses
* Average age of horses belonging to an owner with an id of 1
* Total winnings of all horses
* Total winnings of all horses belonging to an owner with an id of 4

---

# SQL is About Tables

```
> psql
> \c election_development
> SELECT * FROM candidates
> SELECT * FROM candidates WHERE id = 1
> SELECT * FROM parties WHERE id = 1
> SELECT * FROM candidates JOIN parties ON candidates.party_id = parties.id
```

---

# ActiveRecord is About Objects

```
> rails c
> Candidate.all
> Candidate.find(1)
> Parties.find(1)
> Candidate.find(1).parties
> Candidate.joins(:parties)
```

---

# ActiveRecord Attributes

* Methods generated by AR based on table columns
    * candidates has an `id`, `name`, and `party_id`
    * Candidate.first responds to `#id`, `#name`, and `#party_id`
* If we can make a table with columns, AR will create the methods to match
* What determines what kind of object AR returns?

---

# Exercise 1

Can you recreate the table below using SQL?

```
      name       | vote_totals
-----------------+-------------
 Hillary Clinton |    15692452
 Bernie Sanders  |    11959102
  No Preference  |        8152
 Martin O'Malley |         752
  Uncommitted    |          43
(5 rows)
```

---

# Exercise 2

Can you create an array of democratic candidates ordered by the number of results they received that also responds to `vote_totals`?

```
# rails c
> candidates = YOUR QUERY HERE
> candidates.first.name
> "Hillary Clinton"
> candidates.first.total_votes
# => 15692452
```

* How would you make this into a method on your Candidate model?


